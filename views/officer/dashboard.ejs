<h1 class="mb-4 fw-bold text-primary">
    <i class="bi bi-speedometer2 me-2"></i> Officer Dashboard
</h1>

<!-- Filter Section -->
<div class="card shadow-sm border-0 mb-4">
    <div class="card-body">
        <form id="filterForm" method="GET" action="/officer/requests" class="row g-3 align-items-center">
            <!-- Search -->
            <div class="col-md-3">
                <div class="input-group">
                    <span class="input-group-text bg-white"><i class="bi bi-search"></i></span>
                    <input type="text" name="q" class="form-control" placeholder="Search by name or request ID" value="<%= q || '' %>">
                </div>
            </div>

            <!-- Status -->
            <div class="col-md-2">
                <select name="status" class="form-select">
                    <option value="">All statuses</option>
                    <option value="submitted" <%= status==='submitted' ? 'selected' : '' %>>Submitted</option>
                    <option value="under_review" <%= status==='under_review' ? 'selected' : '' %>>Under Review</option>
                    <option value="approved" <%= status==='approved' ? 'selected' : '' %>>Approved</option>
                    <option value="rejected" <%= status==='rejected' ? 'selected' : '' %>>Rejected</option>
                </select>
            </div>

            <!-- Date Range -->
            <div class="col-md-3">
                <input type="date" name="from" class="form-control" placeholder="From" value="<%= fromDate || '' %>">
            </div>
            <div class="col-md-3">
                <input type="date" name="to" class="form-control" placeholder="To" value="<%= toDate || '' %>">
            </div>

            <!-- Filter Button -->
            <div class="col-md-1">
                <button type="submit" class="btn btn-primary w-100 d-flex align-items-center justify-content-center">
                    <i class="bi bi-funnel me-1"></i>
                </button>
            </div>
        </form>
    </div>
</div>

<!-- Requests Table / Empty State -->
<div class="card shadow-sm border-0">
    <div class="card-header bg-white border-0 d-flex justify-content-between align-items-center">
        <h5 class="mb-0 fw-semibold">Recent Requests</h5>
        <small class="text-muted"><%= requests.length %> records found</small>
    </div>
    <div class="table-responsive">
        <% if (requests.length === 0) { %>
            <div class="text-center py-5">
                <i class="bi bi-inbox fs-2 d-block mb-3 text-muted"></i>
                <h5 class="text-muted mb-2">No requests found yet</h5>
                <% if (services && services.length > 0) { %>
                    <p class="text-secondary">Your department offers these services:</p>
                    <ul class="list-group list-group-flush mx-auto" style="max-width: 400px;">
                        <% services.forEach(s => { %>
                            <li class="list-group-item d-flex justify-content-between align-items-center">
                                <%= s.name %>
                                <% if(s.fee && s.fee > 0) { %>
                                    <span class="badge bg-info text-dark">$<%= s.fee %></span>
                                <% } %>
                            </li>
                        <% }) %>
                    </ul>
                <% } %>
            </div>
        <% } else { %>
            <table class="table table-hover table-striped align-middle mb-0">
                <thead class="table-light">
                <tr>
                    <th>#</th>
                    <th>Request #</th>
                    <th>Service</th>
                    <th>Citizen</th>
                    <th>Status</th>
                    <th class="text-center">Actions</th>
                </tr>
                </thead>
                <tbody>
                <% requests.forEach(r => { %>
                    <tr>
                        <td><%= r.id %></td>
                        <td><%= r.request_number %></td>
                        <td><%= r.service_name %></td>
                        <td><%= r.citizen_name %></td>
                        <td>
                            <% let badgeClass = {
                                submitted: "secondary",
                                under_review: "warning",
                                approved: "success",
                                rejected: "danger"
                            }[r.status]; %>
                            <span class="badge bg-<%= badgeClass %> text-uppercase px-3 py-2">
                                    <%= r.status.replace('_', ' ') %>
                                </span>
                        </td>
                        <td class="text-center">
                            <a href="/officer/requests/<%= r.id %>" class="btn btn-sm btn-outline-primary" data-bs-toggle="tooltip" title="View Details">
                                <i class="bi bi-folder2-open"></i>
                            </a>
                        </td>
                    </tr>
                <% }) %>
                </tbody>
            </table>
        <% } %>
    </div>
</div>

<script>
    var tooltipTriggerList = [].slice.call(document.querySelectorAll('[data-bs-toggle="tooltip"]'));
    var tooltipList = tooltipTriggerList.map(function (tooltipTriggerEl) {
        return new bootstrap.Tooltip(tooltipTriggerEl);
    });
</script>
